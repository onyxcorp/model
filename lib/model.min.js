var lodash={arrays:{remove:require("lodash-node/modern/arrays/remove"),difference:require("lodash-node/modern/arrays/difference")},collections:{forEach:require("lodash-node/modern/collections/forEach"),find:require("lodash-node/modern/collections/find"),filter:require("lodash-node/modern/collections/filter")},objects:require("lodash-node/modern/objects"),utils:require("lodash-node/modern/utilities")},SchemaValidator=require("jsonschema").Validator,Formatter=require("formatter"),Transmuter=require("transmuter"),extend=require("backbone-extend-standalone"),ModelValidator;ModelValidator=new SchemaValidator;var Model=function(t,e){var s=t||{};e=e||{},this.cid=lodash.utils.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),s=lodash.objects.defaults({},s,lodash.utils.result(this,"defaults")),this.set(s,e),this.changed={},this.initialize.apply(this,arguments)};lodash.objects.assign(Model.prototype,{_validTypes:{},_schema:null,changed:null,validationError:"",idAttribute:"id",className:"Model",initialize:function(){if(!this._schema)throw new Error("You forgot to set a _schema for the model","index.js",80)},toJSON:function(){return lodash.objects.cloneDeep(this.attributes)},has:function(t){return null!=this.get(t)},find:function(t,e,s){var i;if(s=s||!0,i=this.attributes[t],lodash.objects.isNumber(i))throw new Error("Find can only be performed on String, Array or Object type attribute","index.js",106);return lodash.collections[s?"find":"filter"](this.attributes[t],e)},to:function(t,e){t=Formatter.camelize(t);var s=[].slice.call(arguments);if(lodash.arrays.remove(s,function(s){return s===t||s===e}),s.unshift(this.attributes[e]),this[t])return this[t].apply(this,s);if(Formatter[t])return Formatter[t].apply(null,s);throw new Error("Formatting function not found: "+t+".","index.js",135)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},get:function(t){if(this._schema.properties[t])return this.attributes[t];throw new Error("Trying to get the attribute: "+t+", but it was not found at the current model _schema","index.js",160)},set:function(t,e,s){var i,r,o,a,n,l,h;if(null==t)return this;if("object"==typeof t?(r=t,s=e):(r={})[t]=e,h={unset:!1},s=lodash.objects.defaults({},s,h),!this.checkSchema(r))return!1;o=s.unset,a=[],this._previousAttributes=lodash.objects.clone(this.attributes),this.changed={},l=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(i in r)n=r[i],lodash.objects.isEqual(this.attributes[i],n)||a.push(i),lodash.objects.isEqual(l[i],n)?delete this.changed[i]:this.changed[i]=e,o?delete this.attributes[i]:this.attributes[i]=n;return this.collection&&this.collection.modelUpdate(this),this},unset:function(t,e){return this.set(t,void 0,lodash.objects.assign({},e,{unset:!0}))},clear:function(t){var e,s;e={};for(s in this.attributes)e[s]=void 0;return this.set(e,lodash.objects.assign({},t,{unset:!0}))},hasChanged:function(t){return null==t?!lodash.objects.isEmpty(this.changed):lodash.objects.has(this.changed,t)},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return lodash.objects.clone(this._previousAttributes)},isValid:function(){return!Transmuter.toBoolean(this.validationError)},checkSchema:function(t){var e,s;if(this._validTypes&&lodash.objects.assign(ModelValidator.attributes,this._validTypes),t=lodash.objects.assign({},this.attributes,t),!this._schema)throw new Error("You must set a _schema for this model, otherwise validate will always return false","index.js",309);if(s=lodash.arrays.difference(lodash.objects.keys(t),lodash.objects.keys(this._schema.properties)),!lodash.objects.isEmpty(s))throw new Error("You are trying to set attributes that are not described on the model _schema:"+s.toString(),"index.js",313);return e=ModelValidator.validate(t,this._schema),e.valid||(this.validationError=e.toString()),this.isValid()},_previousAttributes:{}}),lodash.collections.forEach(["transform","values","pairs","invert","pick","omit"],function(t){lodash.objects[t]&&(Model.prototype[t]=function(){var e=[].slice.call(arguments);return e.unshift(this.attributes),lodash.objects[t].apply(lodash.objects,e)})}),Model.extend=extend,module.exports=Model;
